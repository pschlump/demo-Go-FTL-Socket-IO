<!DOCTYPE html>
<html>
<head>
<title>Go (golang) Socket.IO chat</title>
<link rel="stylesheet" href="css/style.css" type="text/css">
<style>
.status-area {
	position: relative;
	bottom: 12px;
	font-size: 11px;
	color: #777;
}
.pos1 {
	position: relative;
	bottom: -2px;
}
</style>
</head>
<body>

<div style="display: block;" class="category send-message modal fade in">
<button type="button" class="close alert-close"><span>x</span></button>
<div>
	<h1>Welcome: Chat Window</h1>	<!-- name at top -->
</div>
<hr>
<div id="scroll-div" class="stop-overflow">
<ul id="messages"></ul>
</div>
<div class="status-area">
	<span id="statusa">&nbsp;</span>
</div>
<div class="send-message-form">
	<input id="m" autocomplete="off" class="input-message form-control pos1" placeholder="Type Your Message" type="text" onKeyPress="catchEnterKey(event, this)">
	<button id="send" class="signup-prompt-category-submit submit-form btn btn-orange">Send</button>
</div>
</div>
</div>
<div class="modal-backdrop fade in"></div>

<script src="/js/socket.io.js"></script>
<script src="/js/jquery-1.11.1.js"></script>
<script>

function catchEnterKey(e, input){
	var code = (e.keyCode ? e.keyCode : e.which);
	if(code == 13) { //Enter keycode
		//	alert('enter press');
		var msg = $('#m').val();
		// socket.emit('chat message', msg);
		socket.emit('msg', JSON.stringify( { "name":"chat", "body": msg } ));
		$('#messages').append($('<li>').text(msg));
		updateScroll();
		$('#m').val('');
		return false;
	}
	if(code == 27) { //ESC keycode
		return false;
	}
}

function updateScroll(){
	var element = document.getElementById("scroll-div");
	element.scrollTop = element.scrollHeight;
}

var socket = io();
$("#send").click(function(){
	var msg = $('#m').val();
	// socket.emit('chat message', msg);
	socket.emit('msg', JSON.stringify( { "name":"chat", "body": msg } ));
	$('#messages').append($('<li>').text(msg));
	updateScroll();
	$('#m').val('');
	return false;
});
socket.on('chat message', function(msg){
	$('#messages').append($('<li>').text(msg));
	updateScroll();
});
socket.on('r:msg', function(body){
	$('#messages').append($('<li>').text(body));
	updateScroll();
});
socket.on('r:sta', function(body){
	$('#statusa').text(body);
});

updateScroll();
</script>

</body>
</html>
